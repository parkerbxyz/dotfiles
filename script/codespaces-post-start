#!/usr/bin/env bash
#
# Run by Codespaces after starting

# Install Homebrew if not installed
if ! command -v brew >/dev/null; then
  # Set $HOMEBREW_PREFIX
  OS="$(uname)"
  if [[ "${OS}" == "Linux" ]]; then
    HOMEBREW_PREFIX="/home/linuxbrew/.linuxbrew"
  elif [[ "${OS}" == "Darwin" ]]; then
    HOMEBREW_PREFIX="/opt/homebrew"
  else
    abort "Homebrew is only supported on macOS and Linux."
  fi

  # Set $SHELL_PROFILE
  case "${SHELL}" in
  */bash*)
    if [[ -r "${HOME}/.bash_profile" ]]; then
      SHELL_PROFILE="${HOME}/.bash_profile"
    else
      SHELL_PROFILE="${HOME}/.profile"
    fi
    ;;
  */zsh*)
    SHELL_PROFILE="${HOME}/.zprofile"
    ;;
  *)
    SHELL_PROFILE="${HOME}/.profile"
    ;;
  esac

  # Add Homebrew to PATH
  (echo; echo "eval \$(${HOMEBREW_PREFIX}/bin/brew shellenv)") >>"${SHELL_PROFILE}"
  echo "\$(${HOMEBREW_PREFIX}/bin/brew shellenv)"
  eval "\$(${HOMEBREW_PREFIX}/bin/brew shellenv)"

  # shellcheck source=/dev/null
  NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Install fish if not installed
if ! command -v fish >/dev/null; then
  brew install fish
fi

# Install font-fira-code-nerd-font (Starship dependency)
brew tap homebrew/cask-fonts
brew install font-fira-code-nerd-font

# Install Starship
brew install starship

# Disable Starship container configuration
echo "
[container]
disabled = true" >> ~/.config/starship.toml

# Use default commit signing configuration
git config --global --unset user.signingkey
git config --global --unset gpg.format
git config --global --unset gpg.ssh.program
git config --global --unset commit.gpgsign

# Install VSCode extensions
script/install-vscode-extensions
